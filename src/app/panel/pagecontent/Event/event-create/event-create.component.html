<div class="page-title">
  <div class="title_left">
    <h3>رخ داد</h3>
  </div>

</div>
<div class="clearfix"></div>

<div class="row">

  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h3>ایحاد رخ داد جدید
        </h3>

        <div class="clearfix"></div>
      </div>
      <div class="x_content">
        <!-- Smart Wizard -->
        <p>برای ایجاد رخ داد جدید می بایست چند مرحله را طی کنید.</p>
        <div id="wizard" class="form_wizard wizard_horizontal">
          <ul class="wizard_steps">
            <li>
              <a  [ngClass]="whatIsMyStyle(1)">
                <span class="step_no">1</span>
                <span class="step_descr">
                                              قدم اول<br/>
                                              <small>    انتخاب دستگاه </small>
                                          </span>
              </a>
            </li>
            <li>
              <a  [ngClass]="whatIsMyStyle(2)">
                <span class="step_no">2 </span>
                <span class="step_descr">
                                              قدم دوم<br/>
                                              <small> توضیحات قدم دوم</small>
                                          </span>
              </a>
            </li>
            <li>
              <a [ngClass]="whatIsMyStyle(3)">
                <span class="step_no">3 </span>
                <span class="step_descr">
                                              قدم سوم<br/>
                                              <small>توضیحات قدم سوم</small>
                                          </span>
              </a>
            </li>
            <li>
              <a  [ngClass]="whatIsMyStyle(4)">
                <span class="step_no">4</span>
                <span class="step_descr">
                                              قدم چهارم<br/>
                                              <small>توضیحات قدم چهارم</small>
                                          </span>
              </a>
            </li>

          </ul>

          <div *ngIf="currentSection === 1" id="step-1">
            <h4 class="StepTitle">انتخاب دستگاه</h4>
            <p *ngIf="commandsNumber ==0"> هیچ نوع دستوری تعریف نشده است.</p>
            <p *ngIf="!IseDevicesLoaded"> دستگاهی برای نمایش وجود ندارد.</p>
            <div *ngIf="IseDevicesLoaded && commandsNumber>0">
    <p >
      دستگاه هایی که برای آنها بخش دیتا وجود دارد در زیر نمایش داده می شوند. دستگاه مورد نظر را انتخاب نمایید.
    </p>

    <table   id="datatable" class="table table-striped table-bordered">
      <thead>
      <tr>
        <th></th>
        <th>نام دستگاه</th>
        <th>تعداد آدرس publish</th>
        <th>تعداد آدرس subscribe</th>
        <th>تعداد آدرس pubsub</th>
        <th>تعداد command</th>
        <th>تعداد data</th>
        <th>عملیات</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let device of devices; let i =index">
        <td>{{i+1}}</td>
        <td>{{device.devicename}}</td>
        <td>
          <div style="text-align: center" *ngIf="device.publish.length>0">{{device.publish.length}}</div>
          <div style="text-align: center" *ngIf="device.publish.length === 0"> -- </div>

        </td>
        <td>
          <div style="text-align: center" *ngIf="device.subscribe.length>0">{{device.subscribe.length}}</div>
          <div style="text-align: center" *ngIf="device.subscribe.length === 0"> -- </div>

        </td>
        <td>
          <div  style="text-align: center" *ngIf="device.pubsub.length>0">{{device.pubsub.length}}</div>
          <div style="text-align: center" *ngIf="device.pubsub.length === 0"> -- </div>

        </td>
        <td>
          <div style="text-align: center" *ngIf="device.command.length>0">{{device.command.length}}</div>
          <div style="text-align: center" *ngIf="device.command.length === 0"> -- </div>

        </td>
        <td>
          <div style="text-align: center" *ngIf="device.data.length>0">{{device.data.length}}</div>
          <div style="text-align: center" *ngIf="device.data.length === 0"> -- </div>

        </td>
        <td>
          <a style="text-align: center" class="btn btn-default" (click)="selectedDevices = device;nexSection()">انتخاب </a>

        </td>
      </tr>
      </tbody>
    </table>

  </div>

          </div>
          <div *ngIf="currentSection === 2"  id="step-2">
            <h4 class="StepTitle">انتخاب آدرس داده</h4>
            <div *ngIf="selectedDevices.devicename ===''">
              <p style="text-align: center;">
                 هنوز دستگاهی انتخاب نکرده اید.
              </p>
            </div>
            <div *ngIf="selectedDevices.devicename !==''">
              <p>
                آدرس تاپیک مورد نظر خود را انتخاب کنید.
              </p>
              <table id="datatable-responsive" class="table table-striped table-bordered dt-responsive nowrap"
                     cellspacing="0" width="100%">
                <thead>
                <tr>
                  <th>نام دستگاه</th>
                  <th>نوع تاپیک</th>
                  <th>آدرس تاپیک</th>
                  <th>عملیات</th>

                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let topic of selectedDevices.subscribe">
                  <td>{{selectedDevices.devicename}}</td>
                  <td> subscribe </td>
                  <td  class="topic">{{topic}}</td>
                  <td><a class="btn btn-default" (click)="selectedAddress =topic;nexSection()">انتخاب</a></td>
                </tr>
                <tr *ngFor="let topic of selectedDevices.publish">
                  <td>{{selectedDevices.devicename}}</td>
                  <td> publish </td>
                  <td  class="topic">{{topic}}</td>
                  <td><a class="btn btn-default" (click)="selectedAddress = topic;nexSection()">انتخاب</a></td>
                </tr>
                <tr *ngFor="let topic of selectedDevices.pubsub">
                  <td>{{selectedDevices.devicename}}</td>
                  <td>pubsub</td>
                  <td class="topic">{{topic}}</td>
                  <td><a class="btn btn-default"  (click)="selectedAddress = topic;nexSection()">انتخاب</a></td>
                </tr>
                <tr *ngFor="let cm of selectedDevices.command">
                  <td>{{selectedDevices.devicename}}</td>
                  <td>command </td>
                  <td class="topic">{{cm.topic}}</td>
                  <td><a class="btn btn-default" (click)="selectedAddress =cm.topic;nexSection()">انتخاب </a></td>
                </tr>
                <tr *ngFor="let d of selectedDevices.data">
                  <td>{{selectedDevices.devicename}}</td>
                  <td>data </td>
                  <td class="topic">{{d.topic}}</td>
                  <td><a class="btn btn-default" (click)="selectedAddress = d.topic;nexSection()">انتخاب</a></td>
                </tr>
                </tbody>
              </table>
            </div>

          </div>
          <div *ngIf="currentSection === 3" id="step-3">
            <h4 class="StepTitle">انتخاب دستور مورد نظر</h4>
            <div *ngIf="selectedAddress === '' ">
                      آدرسی انتخاب نشده است.
            </div>
          <div *ngIf="selectedAddress!== '' ">
            <div *ngFor="let device of devices">
              <div *ngIf="device.command !== null && device.command.length >0 ">
                <h5>انتخاب دستور دستگاه {{device.devicename}}</h5>
                <hr>

                <table  class="table table-striped table-bordered">
                  <thead>
                  <tr>
                    <th></th>
                    <th>نام دستور</th>
                    <th>توضیحات</th>
                    <th>مقدار</th>
                    <th>آدرس</th>
                    <th>عملیات</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let cm of device.command;let i = index">
                    <td>{{i+1}}</td>
                    <td>{{cm.name}}</td>
                    <td>{{cm.dsc}}</td>
                    <td>{{cm.value}}</td>
                    <td>{{cm.topic}}</td>
                    <td><a class="btn btn-default" (click)="selectedCommand =cm;nexSection()">انتخاب</a></td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          </div>
          <div *ngIf="currentSection === 4" id="step-4">
            <h4 class="StepTitle">تعیین شرایط رخ داد</h4>
            <p *ngIf="selectedCommand.name === ''">
               دستوری انتخاب نشده است. لطفا به مرحله قبل بازگشته و دستوری را انتخاب نمایید.
            </p>
            <div *ngIf="selectedCommand.name !==''">
              <app-create-condition ></app-create-condition>
            </div>
            <br>
          </div>

            <br>
        </div>
        <!-- End SmartWizard Content -->

        <!-- End SmartWizard Content -->
      </div>
<br>
      <div style="float: left">
        <button *ngIf="currentSection === MaxSection " class="btn btn-danger" (click)="clearCondition()"> پاک سازی شرایط رخ داد</button>
        <button class="btn btn-default" [disabled]="currentSection === 1"  (click)="prevSection()"> قبلی </button>
        <button class="btn btn-primary" [disabled]="currentSection === MaxSection " (click)="nexSection()"> بعدی </button>
      </div>
    </div>
  </div>
</div>
<div *ngIf="IsConditionSelected()" class="row">
    <h3>وضعیت رخداد انتخابی </h3>


  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h3>ایحاد رخ داد جدید
        </h3>

        <div class="clearfix"></div>
      </div>
      <div class="x_content">
        <table    class="table table-striped table-bordered">
          <thead>
          <tr>
            <th>آدرس داده </th>
            <th>نوع دستور</th>
            <th>نام دستور</th>
            <th> نام کلید json</th>
            <th>نوع شرط رخ داد</th>
            <th>حدود شرط رخ داد</th>
          </tr>
          </thead>
          <tr>
            <td>
              {{selectedAddress}}
            </td>
            <td>mqtt</td>
            <td>
              {{selectedCommand.name}}
            </td>
            <td>
              <div *ngIf="conditionSelected.json_attribute_name && conditionSelected.json_attribute_name!== ''">{{conditionSelected.json_attribute_name}}</div>
              <div *ngIf="!conditionSelected.json_attribute_name || conditionSelected.json_attribute_name === ''"> --</div>
            </td>
            <td>
              <div [ngSwitch]="conditionSelected.condition_type">
                <div *ngSwitchCase="0">کوچکتر از عدد</div>
                <div *ngSwitchCase="1"> بزرگتر از عدد</div>
                <div *ngSwitchCase="2">بین دو عدد</div>
                <div *ngSwitchCase="3"> برابر با</div>
              </div>
            </td>
            <td>
            <div *ngIf="conditionSelected.attr[0] !==null"> {{conditionSelected.attr[0]}}</div>
              <div *ngIf="conditionSelected.attr[1] !==null"> -  {{conditionSelected.attr[1]}}</div>

            </td>
          </tr>
          <tbody>
          </tbody>
        </table>

      </div>
    </div>
    <button class="btn btn-success" (click)="submitEvent()"> ایجاد رخ داد</button>
  </div>

</div>
